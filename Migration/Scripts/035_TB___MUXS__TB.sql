-- Ordem: 035 | Tabela: TB___MUXS__TB | Depth: 2
INSERT INTO CLARO.TB___MUXS__TB (
CL___PROXY_CODE__CL,
CL___MUX_NO__CL,
CL___MUX_LOCAL_ID__CL,
CL___MUX_SERIAL_NO__CL,
CL___MODEL_CODE__CL,
CL___MUX_FIRM_VERSION__CL,
CL___MUX_CPU_STATUS__CL,
CL___MUX_STATUS__CL,
CL___MUX_RESETS__CL,
CL___HARDWARE_ID__CL,
CL___STATUS_ID__CL,
CL___CONFIG_ID__CL,
CL___LAST_UPDATE__CL,
CL___VENDOR_CODE__CL,
CL___CIRCUIT_MISMATCH__CL,
NAME,
COUNTRY,
STATE,
CITY,
ROOM,
SHELF,
NOTES,
STATION,
HW_VERSION,
MANAGEABLE,
LAST_FAIL,
RESOURCE_ID,
LAST_FAIL_CAUSE,
PROJECT_ID,
ADDRESS,
MODEL_NAME,
ERP_CODE
)
SELECT 
j371.CL___PROXY_CODE__CL AS CL___PROXY_CODE__CL,
src.CL___MUX_NO__CL,
src.CL___MUX_LOCAL_ID__CL,
src.CL___MUX_SERIAL_NO__CL,
j372.CL___MODEL_CODE__CL AS CL___MODEL_CODE__CL,
src.CL___MUX_FIRM_VERSION__CL,
src.CL___MUX_CPU_STATUS__CL,
src.CL___MUX_STATUS__CL,
src.CL___MUX_RESETS__CL,
src.CL___HARDWARE_ID__CL,
src.CL___STATUS_ID__CL,
src.CL___CONFIG_ID__CL,
src.CL___LAST_UPDATE__CL,
j370.VENDOR_CODE AS CL___VENDOR_CODE__CL,
src.CL___CIRCUIT_MISMATCH__CL,
src.NAME,
src.COUNTRY,
src.STATE,
src.CITY,
src.ROOM,
src.SHELF,
src.NOTES,
src.STATION,
src.HW_VERSION,
src.MANAGEABLE,
src.LAST_FAIL,
j373.RESOURCE_ID AS RESOURCE_ID,
src.LAST_FAIL_CAUSE,
src.PROJECT_ID,
src.ADDRESS,
src.MODEL_NAME,
LOWER(RAWTOHEX(STANDARD_HASH(TRIM(CAST(src.CL___PROXY_CODE__CL AS VARCHAR2(100))) || '|' || TRIM(CAST(src.CL___MUX_NO__CL AS VARCHAR2(100))) || '|' || TRIM(CAST(src.CL___MUX_LOCAL_ID__CL AS VARCHAR2(100))), 'MD5'))) AS ERP_CODE
FROM OI.TB___MUXS__TB src
LEFT JOIN CLARO.VENDORS j370 ON j370.VENDOR_CODE = src.CL___VENDOR_CODE__CL
LEFT JOIN CLARO.TB___PROXIES__TB j371 ON j371.ERP_CODE = TRIM(CAST(src.CL___PROXY_CODE__CL AS VARCHAR2(64)))
LEFT JOIN CLARO.TB___MODELS__TB j372 ON j372.CL___MODEL_CODE__CL = src.CL___MODEL_CODE__CL
LEFT JOIN CLARO.PROVISIONING_RESOURCE j373 ON j373.ERP_CODE = TRIM(CAST(src.RESOURCE_ID AS VARCHAR2(64)))
WHERE NOT EXISTS (SELECT 1 FROM CLARO.TB___MUXS__TB dest WHERE dest.ERP_CODE = LOWER(RAWTOHEX(STANDARD_HASH(TRIM(CAST(src.CL___PROXY_CODE__CL AS VARCHAR2(100))) || '|' || TRIM(CAST(src.CL___MUX_NO__CL AS VARCHAR2(100))) || '|' || TRIM(CAST(src.CL___MUX_LOCAL_ID__CL AS VARCHAR2(100))), 'MD5'))));
