-- Ordem: 061 | Tabela: MS_SPRING_SQUELCH | Depth: 4
INSERT INTO CLARO.MS_SPRING_SQUELCH (
PROXY_CODE,
PROXY_CODE,
PROXY_CODE,
DEV_NO,
DEV_NO,
DEV_NO,
DEV_LOCAL_ID,
DEV_LOCAL_ID,
DEV_LOCAL_ID,
SLOT_NO,
SLOT_NO,
SLOT_NO,
PORT_NO,
PORT_NO,
PORT_NO,
AU4_NO,
WEST_SRC,
WEST_DST,
WEST_DST2,
WEST_LOVC,
EAST_SRC,
EAST_DST,
EAST_DST2,
EAST_LOVC,
CONTROL,
ERP_CODE
)
SELECT 
j190.CL___PROXY_CODE__CL AS PROXY_CODE,
j190.CL___PROXY_CODE__CL AS PROXY_CODE,
j190.CL___PROXY_CODE__CL AS PROXY_CODE,
j190.CL___MUX_NO__CL AS DEV_NO,
j190.CL___MUX_NO__CL AS DEV_NO,
j190.CL___MUX_NO__CL AS DEV_NO,
j190.CL___MUX_LOCAL_ID__CL AS DEV_LOCAL_ID,
j190.CL___MUX_LOCAL_ID__CL AS DEV_LOCAL_ID,
j190.CL___MUX_LOCAL_ID__CL AS DEV_LOCAL_ID,
j190.CL___CARD_NO__CL AS SLOT_NO,
j190.CL___CARD_NO__CL AS SLOT_NO,
j190.CL___CARD_NO__CL AS SLOT_NO,
j190.CL___PORT_NO__CL AS PORT_NO,
j190.CL___PORT_NO__CL AS PORT_NO,
j190.CL___PORT_NO__CL AS PORT_NO,
src.AU4_NO,
src.WEST_SRC,
src.WEST_DST,
src.WEST_DST2,
src.WEST_LOVC,
src.EAST_SRC,
src.EAST_DST,
src.EAST_DST2,
src.EAST_LOVC,
src.CONTROL,
LOWER(RAWTOHEX(STANDARD_HASH(TRIM(CAST(src.PROXY_CODE AS VARCHAR2(100))) || '|' || TRIM(CAST(src.DEV_NO AS VARCHAR2(100))) || '|' || TRIM(CAST(src.DEV_LOCAL_ID AS VARCHAR2(100))) || '|' || TRIM(CAST(src.SLOT_NO AS VARCHAR2(100))) || '|' || TRIM(CAST(src.PORT_NO AS VARCHAR2(100))) || '|' || TRIM(CAST(src.AU4_NO AS VARCHAR2(100))), 'MD5'))) AS ERP_CODE
FROM OI.MS_SPRING_SQUELCH src
LEFT JOIN CLARO.TB___PORTS__TB j190 ON j190.ERP_CODE = LOWER(RAWTOHEX(STANDARD_HASH(TRIM(CAST(src.SLOT_NO AS VARCHAR2(100))) || '|' || TRIM(CAST(src.DEV_LOCAL_ID AS VARCHAR2(100))) || '|' || TRIM(CAST(src.DEV_NO AS VARCHAR2(100))) || '|' || TRIM(CAST(src.PORT_NO AS VARCHAR2(100))) || '|' || TRIM(CAST(src.PROXY_CODE AS VARCHAR2(100))), 'MD5')))
WHERE NOT EXISTS (SELECT 1 FROM CLARO.MS_SPRING_SQUELCH dest WHERE dest.ERP_CODE = LOWER(RAWTOHEX(STANDARD_HASH(TRIM(CAST(src.PROXY_CODE AS VARCHAR2(100))) || '|' || TRIM(CAST(src.DEV_NO AS VARCHAR2(100))) || '|' || TRIM(CAST(src.DEV_LOCAL_ID AS VARCHAR2(100))) || '|' || TRIM(CAST(src.SLOT_NO AS VARCHAR2(100))) || '|' || TRIM(CAST(src.PORT_NO AS VARCHAR2(100))) || '|' || TRIM(CAST(src.AU4_NO AS VARCHAR2(100))), 'MD5'))));
